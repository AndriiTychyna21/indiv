//файл для визначення, на який факультет ти потрапиш
let facultet = "none"; 
let facultets = ["Swarog", "Perun", "Kupalo", "Veles", "Mokosh", "Stribog"];
let questions = ["Питання 1: Що для вас найважливіше у житті?",
                 "Питання 2: Який спосіб відпочинку вам ближчий?",
                 "Питання 3: Що б ви обрали для подарунка друзям?",
                 "Питання 4: Як ви зазвичай вирішуєте проблеми?",
                 "Питання 5: Яка з цих ситуацій вам найбільше підходить?",
                 "Питання 6: Ви можете отримати одне унікальне вміння. Що це буде?",
                 "Питання 7: Куди б ви хотіли вирушити у подорож?"]
let answers = [
    // Питання 1: "Що для вас найважливіше у житті?"
    [
        "2\"> Жити в гармонії з природою та допомагати їй процвітати.",
        "5\"> Розуміти та використовувати фізичні сили природи.",
        "3\"> Виражати себе через творчість і надихати інших.",
        "1\"> Захищати інших і стояти за справедливість.",
        "4\"> Піклуватися про довкілля та знаходити баланс між людьми та природою.",
        "0\"> Створювати щось нове та корисне."
    ],
    // Питання 2: "Який спосіб відпочинку вам ближчий?"
    [
        "1\"> Активні ігри, спорт або походи.",
        "2\"> Робота у саду чи прогулянка лісом.",
        "3\"> Гра на музичних інструментах чи малювання.",
        "5\"> Спостереження за погодою чи створення моделей.",
        "0\"> Ремісничі заняття або виготовлення речей.",
        "4\"> Вивчення екосистем або читання про природу."
    ],
    // Питання 3: "Що б ви обрали для подарунка друзям?"
    [
        "0\"> Практичну річ, виготовлену своїми руками.",
        "1\"> Талісман сили та захисту.",
        "2\"> Кошик із фруктами чи квітами.",
        "3\"> Вірш, пісню чи картину.",
        "4\"> Екологічний набір аксесуарів.",
        "5\"> Старовинний компас, що вказує напрямок вітру."
    ],
    // Питання 4: "Як ви зазвичай вирішуєте проблеми?"
    [
        "3\"> Шукаю творчий підхід і пропоную нестандартні рішення.",
        "2\"> Намагаюсь зберігати гармонію і знаходити компроміс.",
        "5\"> Підходжу з наукової точки зору, щоб знайти рішення, яке працює найкраще.",
        "0\"> Шукаю прості й логічні рішення, які допоможуть усім.",
        "1\"> Підходжу до проблеми стратегічно, шукаючи справедливість для кожного.",
        "4\"> Враховую потреби всіх і знаходжу рішення, яке приносить користь природі."
    ],
    // Питання 5: "Яка з цих ситуацій вам найбільше підходить?"
    [
        "1\"> Організувати захист чи сміливу подорож.",
        "5\"> Створити інноваційний технічний пристрій.",
        "3\"> Надихнути людей своїм шедевром.",
        "4\"> Досліджувати природу та допомагати їй.",
        "0\"> Виготовити щось практичне і корисне.",
        "2\"> Зберегти та відновити ліс."
    ],
    // Питання 6: "Ви можете отримати одне унікальне вміння. Що це буде?"
    [
        "4\"> Відчувати зв’язок із природою та розуміти її мову.",
        "0\"> Створювати будь-які корисні речі власними руками.",
        "5\"> Літати, як вітер, відчуваючи повну свободу.",
        "2\"> Вирощувати врожай у будь-яких умовах.",
        "3\"> Виражати свої почуття через мистецтво, яке вразить увесь світ.",
        "1\"> Захищати слабких і боротися за добро."
    ],
    // Питання 7: "Куди б ви хотіли вирушити у подорож?"
    [
        "5\"> До світу повітряних кораблів і хмар.",
        "3\"> У країну, де кольори створюють картини просто неба.",
        "2\"> У магічний ліс, де дерева розповідають легенди.",
        "1\"> На поля, де лунають крики перемог і оживають історії битв.",
        "4\"> На райський острів гармонії.",
        "0\"> У місто майстрів, де створюються дива."
    ]
]

function swapQuestion(prev, q) {
    if (q >= 0 && q < questions.length) {
        document.getElementById("previous-button").disabled = false;

        // Завантаження choices із sessionStorage
        let choices = JSON.parse(sessionStorage.getItem('choices'));
        if (!choices) {
            choices = Array.from({ length: questions.length }, () => Array(6).fill(0));
        }

        // Збереження відповіді для попереднього питання
        if (prev >= 0) {
            const selected = document.querySelector('input[name="q"]:checked');
            if (selected) {
                const selectedValue = parseInt(selected.value); // Отримуємо індекс вибраної відповіді
                choices[prev].fill(0); // Очищаємо попередні відповіді
                choices[prev][selectedValue] = 1; // Зберігаємо вибір
            }
        }
        sessionStorage.setItem('choices', JSON.stringify(choices)); // Оновлення choices у sessionStorage

        // Формування HTML для поточного питання
        let html = `
            <h1 class="main_text-31">ТЕСТ ДЛЯ ВИЗНАЧЕННЯ ФАКУЛЬТЕТУ</h1>
            <p class="p-test">${questions[q]}</p>
            <div class="rectangle1222"></div>
            <form class="listt">`;
        for (let i = 0; i < 6; i++) {
            html += `
                <label>
                    <input id="r${answers[q][i].charAt(0)}" type="radio" name="q" value="` + answers[q][i] + "</label><br>";
        }
        html += "</form>";

        document.getElementById("question").innerHTML = html;

        // Встановлення вибраного раніше варіанту (якщо є)
        for (let i = 0; i < 6; i++) {
            if (choices[q][i] === 1) {
                document.getElementById(`r${i}`).checked = true;
                break;
            }
        }

        // Обробка кнопки "Далі"
        document.getElementById("next-button").onclick = function () {
            if (q === questions.length - 1) {
                if (calculateFac()) window.location.href = "results.html"; // Завершення тесту
                
            } else {
                swapQuestion(q, q + 1); // Перехід до наступного питання
                if (q + 1 === questions.length - 1) {
                    document.getElementById("next-button").innerHTML = "ЗАВЕРШИТИ ТЕСТ";
                }
            }
        };

        // Обробка кнопки "Назад"
        document.getElementById("previous-button").onclick = function () {
            swapQuestion(q, q - 1); // Повернення до попереднього питання
            if (q - 1 === 0) {
                document.getElementById("previous-button").disabled = true;
            }
            document.getElementById("next-button").innerHTML = "НАСТУПНЕ ПИТАННЯ";
        };

        // Деактивація кнопки "Назад" для першого питання
        if (q === 0) {
            document.getElementById("previous-button").disabled = true;
        }
    }
}


function calculateFac() {
    const values = [0, 0, 0, 0, 0, 0]; 
    let choices = JSON.parse(sessionStorage.getItem('choices'));
    let go = true;
    for (let i = 0; i < questions.length; ++i){
        let count = 0;
        for (let j = 0; j < 6; ++j){
            if (choices[i][j] == 1){
                values[j]++;
                count++;
            }
        }
        if (count == 0) {
            go = false;
            break;
        }
    }
    // Визначення типу особистості з максимальною кількістю відповідей
    if (go){
        const maxIndex = values.indexOf(Math.max(...values));
        facultet = facultets[maxIndex]; 
        sessionStorage.setItem('facultet', facultet);
    }
    else alert("Уведіть всі поля!");
    return go
}
